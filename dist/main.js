(()=>{"use strict";class e{constructor(e,{selector:t,handleCardClick:r}){this._name=e.name,this._link=e.link,this._selector=t,this._handleCardClick=r}_getTemplate(){return document.querySelector(this._selector).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".element__remove-button").addEventListener("click",this._removeCard.bind(this)),this._element.querySelector(".element__vector").addEventListener("click",this._likeCard),this._element.querySelector(".element__image").addEventListener("click",(()=>this._handleCardClick({name:this._name,link:this._link})))}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".element__image");return this._setEventListeners(),this._element.querySelector(".element__text").textContent=this._name,e.src=this._link,e.setAttribute("alt",this._name),this._element}_removeCard(){this._element.remove(),this._element=null}_likeCard(e){e.target.classList.toggle("element__vector_active")}}class t{constructor(e,t){this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=e}enableValidation(){this._setEventListeners()}_setEventListeners(){const e=this._form.querySelectorAll(this._inputSelector),t=this._form.querySelector(this._submitButtonSelector);e.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(this._form,e,this),this.setButtonState(t,this._form.checkValidity())}))})),this._form.addEventListener("submit",(e=>{e.preventDefault()}))}_checkInputValidity(e,t,r){t.validity.valid?this._hideError(e,t,r):this._showError(e,t,r)}_showError(e,t,r){e.querySelector(`#${t.id}-error`).textContent=t.validationMessage,t.classList.add(r.inputErrorClass)}_hideError(e,t,r){e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)}setButtonState(e,t){t?(e.classList.remove(this._inactiveButtonClass),e.disabled=!1):(e.classList.add(this._inactiveButtonClass),e.disabled=!0)}removeError(e,t,r){e.querySelectorAll(r.inputSelector).forEach((s=>{t._hideError(e,s,r)}))}}class r{constructor({items:e,renderer:t},r){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(r)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.append(e)}addNewItem(e){this._container.prepend(e)}}class s{constructor({popupSelector:e}){this._popupSelector=e}open(){document.querySelector(this._popupSelector).classList.add("popup_opened"),document.addEventListener("keydown",(e=>this._handleEscClose(e))),document.addEventListener("mousedown",(e=>this._handleOverlayClose(e)))}close(){document.querySelector(this._popupSelector).classList.remove("popup_opened"),document.removeEventListener("keydown",(e=>this._handleEscClose(e))),document.removeEventListener("mousedown",(e=>this._handleOverlayClose(e)))}_handleEscClose(e){27===e.keyCode&&this.close()}_handleOverlayClose(e){e.target.classList.contains("popup_opened")&&this.close()}setEventListeners(){document.querySelector(this._popupSelector).querySelector(".popup__close-button").addEventListener("click",(()=>this.close()))}}class o extends s{constructor({popupSelector:e,submitForm:t}){super({popupSelector:e}),this._submitForm=t,this._form=document.querySelector(this._popupSelector).querySelector(".popup__form")}_getInputValues(){const e=this._form.querySelectorAll(".popup__field");return this._formValues={},e.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}close(){super.close(),this._form.reset()}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitForm(this._getInputValues()),this.close()})),super.setEventListeners()}}const n={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_invalid",inputErrorClass:"popup__field_invalid",errorClass:"error"},i=document.querySelector(".profile__name"),l=document.querySelector(".profile__text"),c=".elements",a=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__add-button"),p=document.querySelector(".popup__save-button"),d=document.querySelector(".popup__create-button"),_=document.querySelector(".popup__form_add-form"),m=document.querySelector(".popup__form_edit-form"),h=new t(m,n),v=new t(_,n),S=new r({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:t=>{const r=new e(t,{selector:".template",handleCardClick:e=>{f.open(e)}}).generateCard();S.addItem(r)}},c),f=new class extends s{constructor(e){super(e)}open(e){const t=document.querySelector(".popup-photo__image"),r=document.querySelector(".popup-photo__heading");super.open(),t.src=e.link,t.setAttribute("alt",e.name),r.textContent=e.name}}({popupSelector:".popup-photo"}),y=new o({popupSelector:".popup_add-form",submitForm:t=>{!function(t,s){const o=new r({items:[{name:t,link:s}],renderer:t=>{const r=new e(t,{selector:".template",handleCardClick:e=>{f.open(e)}}).generateCard();o.addNewItem(r)}},c);o.renderItems()}(t["name-of-picture"],t.link)}}),C=new o({popupSelector:".popup_edit-form",submitForm:e=>{E.setUserInfo(e)}}),E=new class{constructor({userNameSelector:e,userInfoSelector:t}){this._userName=document.querySelector(e),this._userInfo=document.querySelector(t)}getUserInfo(){this._userName.value=i.textContent,this._userInfo.value=l.textContent}setUserInfo(e){i.textContent=e.name,l.textContent=e["about-myself"]}}({userNameSelector:".popup__field_name",userInfoSelector:".popup__field_about"});S.renderItems(),h.enableValidation(),v.enableValidation(),f.setEventListeners(),y.setEventListeners(),C.setEventListeners(),a.addEventListener("click",(()=>{C.open(),E.getUserInfo(),h.setButtonState(p,m.checkValidity()),h.removeError(m,h,n)})),u.addEventListener("click",(()=>{y.open(),_.reset(),v.setButtonState(d,_.checkValidity()),v.removeError(_,v,n)}))})();